{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cnsc-haai.github.io/schemas/coh.renorm_criticality_receipt.v1.json",
  "title": "RENORM Criticality Receipt",
  "description": "Receipt schema for renormalization criticality boundary crossing events",
  "type": "object",
  "required": [
    "version",
    "graph_norm_pre_q18",
    "graph_norm_post_q18",
    "contraction_alpha_q18",
    "npe_gain_g_q18",
    "repair_eta_q18",
    "sigma_pre_q18",
    "sigma_post_q18",
    "hash_pre",
    "hash_post",
    "partition_id",
    "timestamp"
  ],
  "additionalProperties": false,
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version"
    },
    "graph_norm_pre_q18": {
      "type": "integer",
      "description": "Graph norm before renormalization (Q18 fixed-point)",
      "minimum": 0
    },
    "graph_norm_post_q18": {
      "type": "integer",
      "description": "Graph norm after renormalization (Q18 fixed-point)",
      "minimum": 0
    },
    "contraction_alpha_q18": {
      "type": "integer",
      "description": "Contraction coefficient alpha (Q18 fixed-point)",
      "minimum": 0
    },
    "npe_gain_g_q18": {
      "type": "integer",
      "description": "NPE gain factor g (Q18 fixed-point)",
      "minimum": 0
    },
    "repair_eta_q18": {
      "type": "integer",
      "description": "Repair/eta factor (Q18 fixed-point), computed as 1/(1 + mu * c * B)",
      "minimum": 0
    },
    "sigma_pre_q18": {
      "type": "integer",
      "description": "Operator criticality sigma before renormalization (Q18 fixed-point). Must be > 2^18 for acceptance (i.e., sigma > 1)",
      "minimum": 0
    },
    "sigma_post_q18": {
      "type": "integer",
      "description": "Operator criticality sigma after renormalization (Q18 fixed-point). Must be <= 2^18 for acceptance (i.e., sigma <= 1)",
      "minimum": 0
    },
    "hash_pre": {
      "type": "string",
      "description": "Hash of graph state before renormalization",
      "pattern": "^[a-f0-9]{64}$"
    },
    "hash_post": {
      "type": "string",
      "description": "Hash of graph state after renormalization",
      "pattern": "^[a-f0-9]{64}$"
    },
    "partition_id": {
      "type": "string",
      "description": "Partition identifier for the renormalization event"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of the renormalization event",
      "format": "date-time"
    },
    "event_id": {
      "type": "string",
      "description": "Unique identifier for this renormalization event"
    },
    "parent_event_id": {
      "type": "string",
      "description": "Parent event ID for chain tracing"
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata about the renormalization event",
      "properties": {
        "node_count_pre": {
          "type": "integer",
          "description": "Number of nodes before renormalization"
        },
        "node_count_post": {
          "type": "integer",
          "description": "Number of nodes after renormalization"
        },
        "edge_count_pre": {
          "type": "integer",
          "description": "Number of edges before renormalization"
        },
        "edge_count_post": {
          "type": "integer",
          "description": "Number of edges after renormalization"
        },
        "budget_before": {
          "type": "integer",
          "description": "Budget value before renormalization"
        },
        "cascade_duration": {
          "type": "integer",
          "description": "Duration of cascade event in steps"
        }
      }
    }
  },
  "allOf": [
    {
      "description": "Acceptance predicate: norm_post < norm_pre",
      "not": {
        "properties": {
          "graph_norm_post_q18": {
            "minimum": 1
          }
        }
      }
    },
    {
      "description": "Acceptance predicate: sigma_pre > 1 (i.e., sigma_pre_q18 > 2^18)",
      "properties": {
        "sigma_pre_q18": {
          "minimum": 262145
        }
      }
    },
    {
      "description": "Acceptance predicate: sigma_post <= 1 (i.e., sigma_post_q18 <= 2^18)",
      "properties": {
        "sigma_post_q18": {
          "maximum": 262144
        }
      }
    }
  ]
}
